### Инструкция по настройке подключению WireGuard между **RouterOS** и **Windows 11**

Цель: Настроить VPN-соединение через WireGuard, где пользователь Windows 11 подключается к сети через RouterOS, но интернет-трафик с Windows не идет через VPN.

---

### 1. **Настройка WireGuard на RouterOS**

#### 1.1. Включение WireGuard
Убедитесь, что ваша версия RouterOS поддерживает WireGuard (версия 7.1 или выше). Если поддержка отсутствует, обновите RouterOS.

#### 1.2. Создание интерфейса WireGuard
Выполните команды для создания WireGuard интерфейса:
```routeros
/interface wireguard
add name=wg1 listen-port=51820
```

#### 1.3. Генерация ключей
Сгенерируйте приватный и публичный ключ:
```routeros
/interface wireguard peers
generate-key-pair
```
Копируйте ключи для дальнейшего использования:
- **Приватный ключ** (для RouterOS).
- **Публичный ключ** (для Windows).

#### 1.4. Настройка интерфейса WireGuard
Пропишите приватный ключ и IP-адрес интерфейса:
```routeros
/interface wireguard
set wg1 private-key="ВАШ_ПРИВАТНЫЙ_КЛЮЧ" address=192.168.100.1/24
```

#### 1.5. Добавление клиента (Windows)
Добавьте клиента WireGuard:
```routeros
/interface wireguard peers
add interface=wg1 public-key="ПУБЛИЧНЫЙ_КЛЮЧ_КЛИЕНТА" allowed-address=192.168.100.2/32
```

#### 1.6. Настройка маршрутов
Чтобы Windows могла подключаться к локальной сети через RouterOS, добавьте маршрут:
```routeros
/ip route
add dst-address=192.168.88.0/24 gateway=wg1
```
Где `192.168.88.0/24` — локальная сеть RouterOS.

---

### 2. **Настройка WireGuard на Windows 11**

#### 2.1. Установка клиента WireGuard
1. Загрузите и установите клиент WireGuard с официального сайта: [WireGuard](https://www.wireguard.com/install/).
2. Запустите приложение.

#### 2.2. Генерация ключей
В интерфейсе WireGuard:
1. Нажмите **Add Tunnel** → **Create from Scratch**.
2. Сгенерируйте ключи:
   - Скопируйте **публичный ключ** и вставьте его в RouterOS (см. шаг 1.5).
   - Сохраните приватный ключ.

#### 2.3. Конфигурация клиента
Создайте туннель на стороне Windows. Пример конфигурации:
```
[Interface]
PrivateKey = ВАШ_ПРИВАТНЫЙ_КЛЮЧ
Address = 192.168.100.2/24
DNS = 8.8.8.8

[Peer]
PublicKey = ПУБЛИЧНЫЙ_КЛЮЧ_ROUTEROS
Endpoint = 192.168.1.1:51820
AllowedIPs = 192.168.88.0/24
PersistentKeepalive = 25
```

- **PrivateKey** — приватный ключ Windows.
- **Address** — IP-адрес клиента в сети WireGuard.
- **DNS** — сервер DNS для Windows.
- **PublicKey** — публичный ключ RouterOS.
- **Endpoint** — публичный IP-адрес RouterOS и порт (51820).
- **AllowedIPs** — диапазон сетей, доступных через VPN.

#### 2.4. Сохранение и активация
1. Сохраните конфигурацию.
2. Активируйте туннель, нажав **Activate**.

---

### 3. **Настройка маршрутизации на Windows 11**

Для выхода в интернет напрямую из Windows:
1. Убедитесь, что в конфигурации клиента WireGuard параметр `AllowedIPs` содержит только сеть локального доступа через VPN:
   ```
   AllowedIPs = 192.168.88.0/24
   ```
2. Это позволяет перенаправлять трафик только к сети RouterOS, а интернет останется через локальное соединение Windows.

---

### 4. **Проверка соединения**

1. Проверьте, что Windows может:
   - Пинговать устройства в локальной сети RouterOS (например, `ping 192.168.88.1`).
   - Осуществлять выход в интернет через собственное подключение.
2. На RouterOS убедитесь, что трафик от клиента проходит через интерфейс WireGuard:
   ```routeros
   /interface monitor-traffic wg1
   ```

---

### 5. **Советы по безопасности**

- Используйте сильные ключи (по умолчанию WireGuard создаёт надёжные ключи).
- Настройте фаервол для защиты VPN-порта:
  ```routeros
  /ip firewall filter
  add chain=input action=accept protocol=udp dst-port=51820
  add chain=input action=drop
  ```
- Следите за обновлениями WireGuard на обоих устройствах.

---

Эта настройка обеспечивает защищённое соединение с локальной сетью RouterOS без маршрутизации интернет-трафика через VPN.
